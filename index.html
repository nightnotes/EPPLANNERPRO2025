<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Night Notes – EP Planner (Realtime Sync)</title>
  <style>
*{box-sizing:border-box}body{font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial;margin:0;background:#0b1020;color:#e9eefc}
.header{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid #1f2942;position:sticky;top:0;background:#0b1020;z-index:9}
.container{max-width:1200px;margin:0 auto;padding:16px}
.card{background:#0f1630;border:1px solid #1f2942;border-radius:16px;padding:16px;box-shadow:0 6px 24px rgba(0,0,0,.35)}
.row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.tabs{display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap}
.tab{padding:8px 12px;border-radius:999px;border:1px solid #2a375d;background:#0f1630;cursor:pointer}
.tab.active{background:#1a2750}
.input,select{background:#0b132a;border:1px solid #27365e;color:#e9eefc;padding:8px 10px;border-radius:8px}
.button{background:#3357ff;color:#fff;padding:8px 12px;border:none;border-radius:8px;cursor:pointer}
.button.ghost{background:transparent;border:1px solid #2a375d}
.table{width:100%;border-collapse:collapse}
.table th,.table td{padding:10px 8px;border-bottom:1px solid #1f2942;font-size:14px}
.badge{padding:4px 8px;border-radius:999px;border:1px solid #2a375d;font-size:12px}
.dot{width:10px;height:10px;border-radius:50%}.dot.red{background:#ef4444}.dot.green{background:#22c55e}
.footer{opacity:.6;font-size:12px;text-align:center;padding:16px}
.login{min-height:45vh;display:flex;align-items:center;justify-content:center}
h2{margin:0 0 8px 0}
.small{font-size:12px;opacity:.75}
</style>
</head>
<body>
  <div id="app" class="container"></div>
  <div class="footer">© Night Notes • build: 2025-08-18 11:51:32 UTC</div>
  <script>
(()=>{
  const USERS=[{name:"Martijn",password:"123!"},{name:"Nuno",password:"123!"}];
  const FIREBASE_CONFIG={"apiKey": "AIzaSyDujrir7S_vNDfnNq0ZkcTMHKYxsN5Ba54", "authDomain": "night-notes-c92e3.firebaseapp.com", "projectId": "night-notes-c92e3", "storageBucket": "night-notes-c92e3.firebasestorage.app", "messagingSenderId": "417664221420", "appId": "1:417664221420:web:bdcad8555d9fe157f225c9", "measurementId": "G-56G2YPDWNC"};
  const fmt=s=>new Date(s).toLocaleDateString('nl-NL',{year:'numeric',month:'2-digit',day:'2-digit'});
  const $=(s,c=document)=>c.querySelector(s);

  const Sync={useFirebase:false,db:null,status:'Offline',D:null,G:null,S:null,N:null,
    async init(){ try{ return await this.enable(FIREBASE_CONFIG); } catch(e){ console.error(e); return false; } },
    async enable(cfg){ try{
      const appMod=await import('https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js');
      const fs=await import('https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js');
      const app=appMod.initializeApp(cfg);
      this.db=fs.getFirestore(app); this.D=fs.doc; this.G=fs.getDoc; this.S=fs.setDoc; this.N=fs.onSnapshot;
      this.useFirebase=true; this.status='Online'; console.log('[Sync] Firestore Online project:', cfg.projectId); return true;
    }catch(e){ this.status='Error'; console.error('[Sync] init failed', e); return false; }},
    async get(key,fallback){ if(this.useFirebase&&this.db){ const ref=this.D(this.db,'night-notes',key); const snap=await this.G(ref); if(snap.exists()) return snap.data().value; await this.S(ref,{value:fallback}); return fallback; } try{ return JSON.parse(localStorage.getItem(key)) ?? fallback; }catch{ return fallback; } },
    async set(key,val){ if(this.useFirebase&&this.db){ const ref=this.D(this.db,'night-notes',key); await this.S(ref,{value:val}); console.log('[Sync] pushed', key); return; } localStorage.setItem(key, JSON.stringify(val)); },
    listen(key,cb){ if(this.useFirebase&&this.db){ const ref=this.D(this.db,'night-notes',key); return this.N(ref,(snap)=>{ if(snap.exists()) cb(snap.data().value); }); } return ()=>{}; }
  };

  const state={ user: JSON.parse(localStorage.getItem('user')||'null'), tab:'Releases', releases:[], streams:[] };

  function header(){ const h=document.createElement('div'); h.className='header';
    const left=document.createElement('div'); left.className='row'; const t=document.createElement('h1'); t.textContent='Night Notes – EP Planner'; left.appendChild(t);
    const debug=document.createElement('div'); debug.className='row';
      const status=document.createElement('span'); status.id='syncStatus'; status.className='badge'; status.textContent='Sync: '+Sync.status; debug.appendChild(status);
      const pull=document.createElement('button'); pull.className='button ghost'; pull.textContent='Forceer laden'; pull.title='Cloud → Local'; pull.onclick=async()=>{ const v=await Sync.get('releases',[]); state.releases=v; renderBody(); }; debug.appendChild(pull);
      const push=document.createElement('button'); push.className='button ghost'; push.textContent='Forceer push'; push.title='Local → Cloud'; push.onclick=async()=>{ await Sync.set('releases', state.releases); alert('Naar cloud geschreven'); }; debug.appendChild(push);
      const wipe=document.createElement('button'); wipe.className='button ghost'; wipe.textContent='Wis lokaal'; wipe.onclick=()=>{ localStorage.clear(); alert('Lokale storage gewist. Herlaad de pagina.'); }; debug.appendChild(wipe);
    const right=document.createElement('div'); right.className='row'; const out=document.createElement('button'); out.className='button ghost'; out.textContent= state.user? 'Uitloggen':'Login'; out.onclick=()=>{ if(state.user){ state.user=null; localStorage.removeItem('user'); render(); } }; right.appendChild(out);
    h.appendChild(left); h.appendChild(debug); h.appendChild(right); return h; }

  function tabs(curr,set){ const w=document.createElement('div'); w.className='tabs'; ['Releases','EP Checklist','Streams','Advertentiebeheer'].forEach(t=>{ const b=document.createElement('button'); b.className='tab'+(t===curr?' active':''); b.textContent=t; b.onclick=()=>set(t); w.appendChild(b); }); return w; }

  function viewLogin(){ const box=document.createElement('div'); box.className='card login'; box.innerHTML=`<form class="grid" style="min-width:320px;gap:12px">
    <h2 style="text-align:center">Inloggen</h2>
    <input class="input" name="name" placeholder="Naam (Martijn/Nuno)"/><input class="input" name="pass" type="password" placeholder="Wachtwoord (123!)"/>
    <button class="button" type="submit">Login</button></form>`;
    box.querySelector('form').onsubmit=(e)=>{ e.preventDefault(); const n=e.target.name.value.trim(), p=e.target.pass.value; const ok=['Martijn','Nuno'].includes(n) && p==='123!'; if(!ok) return alert('Onjuiste login'); state.user=n; localStorage.setItem('user', JSON.stringify(n)); render(); };
    return box; }

  function addReleaseForm(onAdd){ const f=document.createElement('div'); f.className='card'; f.innerHTML=`<div class="row" style="gap:8px;flex-wrap:wrap">
      <h2>Release toevoegen</h2><span class="small">(Datum + Artiest verplicht)</span></div>
      <div class="row" style="gap:8px;flex-wrap:wrap">
      <input class="input" type="date" id="relDate"/><input class="input" placeholder="Artiest" id="relArtist" style="min-width:220px"/>
      <select class="input" id="relOwner"><option value="">Owner</option><option>ERRY</option><option>NUNEAUX</option><option>ADHD</option><option>EXTRA</option></select>
      <select class="input" id="relType"><option value="">Type</option><option>Core</option><option>Extra</option><option>ADHD Sleep</option></select>
      <button class="button" id="addBtn">Toevoegen</button></div>`;
    f.querySelector('#addBtn').onclick=()=>{ const date=f.querySelector('#relDate').value; const artist=f.querySelector('#relArtist').value.trim(); const owner=f.querySelector('#relOwner').value||''; const type=f.querySelector('#relType').value||''; if(!date||!artist) return alert('Datum en artiest zijn verplicht'); onAdd({date,artist,owner,type,done:false,splits:false,buma:false}); };
    return f; }

  function releasesView(){ const wrap=document.createElement('div'); wrap.appendChild(addReleaseForm(async it=>{ state.releases.push(it); await Sync.set('releases', state.releases); renderBody(); }));
    const card=document.createElement('div'); card.className='card'; const top=document.createElement('div'); top.className='row'; top.style.cssText='justify-content:space-between;gap:10px;flex-wrap:wrap';
    const left=document.createElement('div'); left.className='row'; const search=document.createElement('input'); search.className='input'; search.placeholder='Zoek op artiest';
    const only=document.createElement('input'); only.type='checkbox'; const lbl=document.createElement('label'); lbl.className='row'; lbl.textContent=' Alleen open'; lbl.prepend(only);
    left.appendChild(search); left.appendChild(lbl); const cnt=document.createElement('span'); cnt.className='badge'; cnt.textContent='0 releases'; top.appendChild(left); top.appendChild(cnt); card.appendChild(top);
    const scroller=document.createElement('div'); scroller.style.cssText='overflow:auto;max-height:60vh;margin-top:8px'; const table=document.createElement('table'); table.className='table';
    table.innerHTML='<thead><tr><th>Datum</th><th>Artiest</th><th>Type</th><th>Owner</th><th>Status</th><th>Splits</th><th>Buma/Stemra</th></tr></thead><tbody></tbody>'; const tbody=table.querySelector('tbody'); scroller.appendChild(table); card.appendChild(scroller);
    function redraw(){ const q=(search.value||'').toLowerCase(); const list=state.releases.filter(r=>!q||(r.artist||'').toLowerCase().includes(q)).filter(r=>!only.checked||!r.done).sort((a,b)=> new Date(a.date)-new Date(b.date));
      cnt.textContent=`${{list.length}} releases`; tbody.innerHTML=''; list.forEach(r=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${{fmt(r.date)}}</td><td>${{r.artist}}</td>
        <td><span class="badge">${{r.type||''}}</span></td><td><span class="badge">${{r.owner||''}}</span></td>
        <td><div class="row"><div class="dot ${{r.done?'green':'red'}}"></div><button class="button ghost">${{r.done?'Klaar':'Open'}}</button></div></td>
        <td><input type="checkbox" ${{r.splits?'checked':''}}></td><td><input type="checkbox" ${{r.buma?'checked':''}}></td>`;
        tr.querySelector('button').onclick=async()=>{{ r.done=!r.done; await Sync.set('releases', state.releases); redraw(); }};
        const [c1,c2]=tr.querySelectorAll('input'); c1.onchange=async e=>{{ r.splits=e.target.checked; await Sync.set('releases', state.releases); }}; c2.onchange=async e=>{{ r.buma=e.target.checked; await Sync.set('releases', state.releases); }};
        tbody.appendChild(tr); }); }
    [search,only].forEach(el=>el.addEventListener('input',redraw)); redraw(); const wrap2=document.createElement('div'); wrap2.appendChild(card); return wrap2; }

  function epChecklist(){ const c=document.createElement('div'); c.className='card'; c.textContent='EP Checklist gebruikt dezelfde data als Releases.'; return c; }
  function streamsView(){ const c=document.createElement('div'); c.className='card'; c.textContent='Streams syncen via document "streams".'; return c; }
  function adsView(){ const c=document.createElement('div'); c.className='card'; c.innerHTML='<a class="button" href="https://eppplannerpro.netlify.app/" target="_blank">Open Advertentiebeheer</a>'; return c; }

  function renderBody(){ const app=document.getElementById('app'); app.innerHTML=''; app.appendChild(tabs(state.tab,(t)=>{ state.tab=t; renderBody(); }));
    if(state.tab==='Releases') app.appendChild(releasesView()); else if(state.tab==='EP Checklist') app.appendChild(epChecklist()); else if(state.tab==='Streams') app.appendChild(streamsView()); else app.appendChild(adsView()); }

  async function boot(){ document.body.prepend(header()); await Sync.init(); $('#syncStatus').textContent='Sync: '+Sync.status;
    const saved=await Sync.get('releases', null); state.releases = saved ?? []; if(saved===null) await Sync.set('releases', state.releases);
    state.streams = await Sync.get('streams', []);
    if(!state.user) document.getElementById('app').appendChild(viewLogin()); else renderBody();
    Sync.listen('releases',(val)=>{ state.releases=val; if(state.tab==='Releases') renderBody(); });
    Sync.listen('streams',(val)=>{ state.streams=val; if(state.tab==='Streams') renderBody(); });
  } boot();
})();
</script>
</body>
</html>
